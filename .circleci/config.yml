version: 2.1

jobs:
  build:

    # Dockerコンテナを利用する
    docker:

      # 後続に記載するstepsを実行するメインとなるDockerコンテナを指定する
      - image: circleci/python:3.7.3

    working_directory: ~/tk-watanabe913
    
    environment:
      - AWS_DEFAULT_REGION: ap-northeast-1
      - AWS_SECRET_ACCESS_KEY: Cu/QduspqMFheY7vQm5VEoK9U9x86bfoEAv9mP7F
      - AWS_ACCESS_KEY_ID: AKIAQ4A4FVSWEAYAVICT
      - AWS_S3_BUCKET_NAME: nitcircletest

    steps:
      # リポジトリのコードを working_directory にチェックアウト
      - checkout

      # テストの実行
      - run:
          name: run tests
          command: |
            python hello_world_test.py
      - run:
          name: Deploy to S3 if branch is Master.
          command: |
            aws s3 sync ~/tk-watanabe913 s3://${AWS_S3_BUCKET_NAME}/ --exact-timestamps --delete
